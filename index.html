<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JDM Archive v9.3</title>
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #c0392b; --bg-color: #f4f6f7; --nav-height: 65px; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg-color); color: #333; margin: 0; padding-bottom: var(--nav-height); }
        header { background: white; padding: 15px; text-align: center; border-bottom: 1px solid #ddd; position: sticky; top: 0; z-index: 100; }
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }
        .tab-content { display: none; } .tab-content.active { display: block; }
        
        /* ë‹¬ë ¥ */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; background: white; padding: 10px; border-radius: 12px; }
        .cal-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; border-radius: 8px; font-size: 0.9rem; cursor: pointer; padding-top: 5px; }
        .cal-day.today { background: #e8f4fd; color: var(--primary-color); font-weight: bold; }
        .dot { width: 6px; height: 6px; background: var(--accent-color); border-radius: 50%; margin-top: 4px; }
        
        /* ëª©ë¡ */
        .memo-card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; position: relative; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: transform 0.1s; }
        .memo-card:active { transform: scale(0.98); }
        
        /* ì…ë ¥ í¼ */
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .btn-save { width: 100%; padding: 15px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        
        /* ë°ì´í„° ë³µì› ë°•ìŠ¤ */
        .restore-box { background: #fff3cd; border: 2px solid #ffc107; padding: 15px; border-radius: 10px; margin-bottom: 15px; }

        /* ëª¨ë‹¬ (íŒì—…ì°½) ë””ìì¸ ê°œì„  */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:2000; align-items:center; justify-content:center; backdrop-filter: blur(2px); }
        .modal-content { background:white; width:85%; max-width:500px; padding:25px; border-radius:15px; max-height:80vh; overflow-y:auto; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .close-btn { position: absolute; top: 15px; right: 15px; font-size: 1.8rem; border: none; background: none; cursor: pointer; color: #999; }
        
        /* ë·°ì–´ ìŠ¤íƒ€ì¼ (ì´ë¯¸ì§€ ë³´ì´ê²Œ) */
        .view-body img { max-width: 100%; border-radius: 8px; margin: 10px 0; display:block; }
        .view-body { line-height: 1.6; white-space: pre-wrap; font-size: 1rem; color: #333; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; display: flex; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; padding: 8px; color: #999; font-size: 0.8rem; cursor: pointer; }
        .nav-item.active { color: var(--primary-color); font-weight: bold; }
        .nav-icon { font-size: 1.4rem; display: block; margin-bottom: 3px; }
    </style>
</head>
<body>
<header><h1>JDM Archive v9.3</h1></header>

<div class="container">
    <div id="tab-calendar" class="tab-content active">
        <div style="display:flex; justify-content:space-between; align-items:center; background:white; padding:15px; border-radius:12px; margin-bottom:10px;">
            <button onclick="changeMonth(-1)" style="border:none; background:none; font-size:1.5rem;">â—€</button>
            <h2 id="currentMonth" style="margin:0;"></h2>
            <button onclick="changeMonth(1)" style="border:none; background:none; font-size:1.5rem;">â–¶</button>
        </div>
        <div id="calendarGrid" class="calendar-grid"></div>
        <div id="calendarMemos" style="margin-top:20px; text-align:center; color:#888;"></div>
    </div>

    <div id="tab-list" class="tab-content">
        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..." onkeyup="renderMemos()">
        <div id="memoList"></div>
    </div>

    <div id="tab-write" class="tab-content">
        <div style="background:white; padding:20px; border-radius:12px;">
            <h3>ğŸ“ ìƒˆ ê¸°ë¡ ì‘ì„±</h3>
            <input type="text" id="inputTitle" placeholder="ì œëª©">
            <select id="inputTag"><option>#ì¼ë°˜</option><option>#ì—…ë¬´</option><option>#ì•„ì´ë””ì–´</option><option>#ê±´ê°•</option><option>#í˜„ì¥</option><option>#AI</option><option>#ì‹¬ë¦¬</option></select>
            <textarea id="inputContent" style="height:150px" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            <input type="text" id="inputLink" placeholder="ê´€ë ¨ ë§í¬ (URL)">
            <label style="display:block; margin-bottom:5px; font-weight:bold;">ğŸ“¸ ì‚¬ì§„ ì²¨ë¶€ (ì—¬ëŸ¬ ì¥ ê°€ëŠ¥)</label>
            <input type="file" id="inputImage" accept="image/*" multiple style="padding:10px; background:#eee; width:100%;">
            <button class="btn-save" onclick="saveMemo()">ì € ì¥</button>
        </div>
    </div>

    <div id="tab-data" class="tab-content">
        <div style="background:white; padding:20px; border-radius:12px; text-align:center;">
            <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
            
            <div class="restore-box">
                <strong style="color:#d35400; display:block; margin-bottom:5px;">ğŸ“‚ íŒŒì¼ë¡œ ë³µì›í•˜ê¸° (ìˆ˜ì •ë¨)</strong>
                <p style="font-size:0.8rem; margin:0 0 10px 0;">Jeong_Backup íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.<br>('notes' ì´ë¦„í‘œë„ ì¸ì‹í•©ë‹ˆë‹¤)</p>
                <input type="file" id="restoreInput" onchange="restoreData(this)" style="background:white; border:1px solid #ccc; width:100%;">
            </div>

             <div style="background:#e3f2fd; padding:15px; border-radius:10px; margin-bottom:20px; border:2px dashed #2196f3;">
                <strong style="color:#1565c0; display:block; margin-bottom:5px;">âš¡ ê¸´ê¸‰ ë°ì´í„° ë³µêµ¬</strong>
                <p style="font-size:0.8rem; margin:0 0 10px 0;">íŒŒì¼ì´ ì•ˆ ë  ë•Œ ëˆ„ë¥´ì„¸ìš”. (11ê°œ ê¸°ë¡ ë³µì›)</p>
                <button onclick="injectEmergencyData()" class="btn-save" style="background:#2196f3; padding:10px;">ë°ì´í„° ê°•ì œ ì£¼ì…</button>
            </div>

            <button onclick="backupData()" class="btn-save" style="background:#27ae60; margin-bottom:10px;">ğŸ“¤ ì „ì²´ ë°±ì—… (íŒŒì¼ ì €ì¥)</button>
            <button onclick="resetApp()" class="btn-save" style="background:#7f8c8d;">âš ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
    </div>
</div>

<div id="viewModal" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeViewModal()">Ã—</button>
        <div style="margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
            <span id="viewTag" style="color:white; background:var(--accent-color); padding:3px 8px; border-radius:4px; font-size:0.8rem;"></span>
            <span id="viewDate" style="color:#888; font-size:0.9rem; margin-left:10px;"></span>
        </div>
        <h2 id="viewTitle" style="margin-top:0; color:#2c3e50;"></h2>
        
        <div id="viewBody" class="view-body"></div>
        
        <div id="viewLink" style="margin-top:20px;"></div>
        
        <div style="margin-top:20px; display:flex; gap:10px;">
            <button class="btn-save" onclick="switchToEditMode()" style="background:#f39c12; flex:1;">ìˆ˜ ì •</button>
            <button class="btn-save" onclick="closeViewModal()" style="background:#999; flex:1;">ë‹« ê¸°</button>
        </div>
    </div>
</div>

<div id="editModal" class="modal">
    <div class="modal-content">
        <h3>ìˆ˜ì •í•˜ê¸°</h3>
        <input type="hidden" id="editId">
        <input type="text" id="editTitle">
        <select id="editTag"><option>#ì¼ë°˜</option><option>#ì—…ë¬´</option><option>#ì•„ì´ë””ì–´</option><option>#ê±´ê°•</option><option>#í˜„ì¥</option><option>#AI</option><option>#ì‹¬ë¦¬</option></select>
        <textarea id="editContent" style="height:150px; font-family:monospace; font-size:0.9rem;" placeholder="HTML ì½”ë“œê°€ ë³´ì…ë‹ˆë‹¤. ì´ë¯¸ì§€ëŠ” ê±´ë“œë¦¬ì§€ ë§ˆì„¸ìš”."></textarea>
        <input type="text" id="editLink">
        <div style="display:flex; gap:10px;">
            <button class="btn-save" onclick="updateMemo()">ì €ì¥ ì™„ë£Œ</button>
            <button class="btn-save" onclick="closeEditModal()" style="background:#999;">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('calendar')"><span class="nav-icon">ğŸ“…</span>í™ˆ</div>
    <div class="nav-item" onclick="switchTab('list')"><span class="nav-icon">ğŸ“‹</span>ëª©ë¡</div>
    <div class="nav-item" onclick="switchTab('write')"><span class="nav-icon">âœï¸</span>ê¸°ë¡</div>
    <div class="nav-item" onclick="switchTab('data')"><span class="nav-icon">ğŸ’¾</span>ë°ì´í„°</div>
</nav>

<script>
    const EMERGENCY_DATA = [{"title":"í´ë¼ìš°ë“œ í…ŒìŠ¤íŠ¸1","link":"https://n.news.naver.com/article/015/0005220929?cds=news_edit","dateStr":"2025. 12. 6.","tag":"#AI","id":1765026140868,"content":"ì‹ ë‚œë‹¤^^"},{"title":"ìƒˆí´ë¼ìš°ë“œ í…ŒìŠ¤íŠ¸2","link":"https://n.news.naver.com/article/015/0005220929?cds=news_edit","dateStr":"2025. 12. 7.","tag":"#ì¼ë°˜","id":1765026186966,"content":"https://n.news.naver.com/article/015/0005220929?cds=news_edit\n\nê°€ë‚˜ë‹¤ë¼. ë§ˆë°”ì‚¬"},{"title":"ëª¨ë°”ì¼ í…ŒìŠ¤íŠ¸","link":"","dateStr":"2025. 12. 6.","tag":"#ì¼ë°˜","id":1765030899297,"content":"ëª¨ë°”ì¼ ì‚¬ì§„ ì²¨ë¶€\n\nê°€ë‚˜ë‹¤ë¼ ë§ˆë°”ì‚¬ì•„. ìì°¨ì¹´íƒ€ã… ã…í•˜íŒŒã…ã…ã…"},{"title":"ì•±ê°œë°œì€ í˜ë“¤ë‹¤.","link":"","dateStr":"2025. 12. 6.","tag":"#AI","id":1765035202224,"content":"ì˜¤ëŠ˜ í•˜ë£¨ì¢…ì¼ ê±°ì˜ 10ì‹œê°„ì„ ë„˜ê²Œ ì´ ì•±ê°œë°œì— ë§¤ë‹¬ë ¸ë‹¤.\n\nì œë¯¸ë‚˜ì´ì˜ ë„ì›€ìœ¼ë¡œ ì—¬ê¸°ê¹Œì§€ ì™”ë‹¤.\n\ní˜ë“¤ê¸´ í•˜ì§€ë§Œ ì¬ë¯¸ìˆëŠ”ê²ƒ ê°™ê¸°ë„ í•˜ë‹¤. ì•±ê°œë°œì—ë„ ê´€ì‹¬ì„ ê°€ì ¸ì•¼ê² ë‹¤"},{"title":"ë‹¤ìš©ë„ì‹¤ ë‹´ë°°","link":"","dateStr":"2025. 12. 7.","tag":"#ì¼ë°˜","id":1765037460264,"content":"ë‚´ ì „ìš©ê³µê°„\n\nì œë¯¸ë‚˜ì´ì™€ ë‚˜ì˜ í•©ì‘ ì•±.ã…ã…"},{"title":"ëŠë½ê³¨êµ ê°€ëŠ” ê¸¸","link":"","dateStr":"2025. 12. 7.","tag":"#ì¼ë°˜","id":1765101591921,"content":"ê·¸ë¦¼ìœ¼ë¡œ ê·¸ë¦¬ê¸° ì¢‹ì€."},{"title":"ì‚¬ë¬´ì‹¤ì—ì„œ í™•ì¸í•¨","link":"https://jeong-archive.netlify.app/","dateStr":"2025. 12. 8.","tag":"#ì¼ë°˜","id":1765156067646,"content":"ì˜ ì‘ë™ë˜ê³  ìˆë‹¤."},{"title":"ìƒˆë¡œìš´ íƒˆëª¨ì¹˜ë£Œì œ ê°œë°œ","link":"https://naver.me/5mhy6hqq","dateStr":"2025. 12. 10.","tag":"#ê±´ê°•","id":1765364574967,"content":"ì´ì œ ì˜ë˜ëŠ”êµ¬ë§Œ\n\ní•˜í•˜í•˜. ê¸°ë¶„ì¢‹ë‹¤"},{"title":"82ì„¸ ë„˜ê²¨ì‚¬ëŠ” ë²•","link":"https://youtube.com/shorts/o93XwcIG0kk?si=phE_-smKqhKJ-Je-","dateStr":"2025. 12. 14.","tag":"#ê±´ê°•","id":1765690658371,"content":"1. ê±·ê¸°\n2. ë‹¨ ë§› ë©€ë¦¬í•˜ê¸°\n3. ì§  ë§› ë©€ë¦¬í•˜ê¸°\n4. 6ì‹œê°„ ì´ìƒ ìˆ˜ë©´\n5. ì‚¬ëŒ ë©€ë¦¬í•˜ì§€ ì•Šê¸°"},{"title":"ì•„ì´ìœ ë² ê²Œ","link":"https://www.sleepnsleepmall.com/surl/P/334&cafe_mkt=ue_GFA_251209_02","dateStr":"2025. 12. 14.","tag":"#ê±´ê°•","id":1765695186989,"content":""},{"title":"ê°ì •ì´ ê±°ì œëœ ì‚¬ëŒì˜ ëª¨ìŠµ","link":"https://naver.me/5zXrBE7E","dateStr":"2025. 12. 14.","tag":"#ì‹¬ë¦¬","id":1765696670203,"content":"ìê¸°ê°€ ìê¸°ì—ê²Œ ì¸ì •ë°›ì§€ ëª»í•œë‹¤ë©´"}];

    const DB_NAME = 'JeongArchiveDB_v9';
    const STORE_NAME = 'memos';
    let db;

    const request = indexedDB.open(DB_NAME, 1);
    request.onupgradeneeded = e => { db = e.target.result; if(!db.objectStoreNames.contains(STORE_NAME)) db.createObjectStore(STORE_NAME, {keyPath:'id'}); };
    request.onsuccess = e => { db = e.target.result; initApp(); };

    function initApp() { renderCalendar(); renderMemos(); }
    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
        document.getElementById('tab-'+tab).classList.add('active');
        const idx = ['calendar','list','write','data'].indexOf(tab);
        document.querySelectorAll('.nav-item')[idx].classList.add('active');
        if(tab==='list') renderMemos();
    }

    function injectEmergencyData() {
        if(!confirm("ê¸´ê¸‰ ë³µêµ¬ë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const tx = db.transaction(STORE_NAME, 'readwrite');
        const store = tx.objectStore(STORE_NAME);
        EMERGENCY_DATA.forEach(item => store.put(item));
        tx.oncomplete = () => { alert("ë³µêµ¬ ì™„ë£Œ!"); switchTab('calendar'); renderCalendar(); };
    }

    // [í•µì‹¬] ìˆ˜ì •ëœ ë³µì› ë¡œì§: notes í‚¤ í™•ì¸
    function restoreData(input) {
        const file = input.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                let raw = e.target.result;
                if (raw.charCodeAt(0) === 0xFEFF) raw = raw.slice(1);
                
                let data = JSON.parse(raw);
                if (typeof data === 'string') data = JSON.parse(data);

                // [ì¤‘ìš”] ë°ì´í„°ê°€ 'notes'ë¼ëŠ” ì£¼ë¨¸ë‹ˆì— ìˆëŠ”ì§€ í™•ì¸
                if (!Array.isArray(data)) {
                     if(data.memos) data = data.memos;
                     else if(data.notes) data = data.notes; // ì—¬ê¸°ê°€ ë²”ì¸ í•´ê²°!
                     else if(typeof data === 'object') data = Object.values(data);
                     else data = [data];
                }

                if(!data || data.length === 0) throw new Error("ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

                const tx = db.transaction(STORE_NAME, 'readwrite');
                const store = tx.objectStore(STORE_NAME);
                let count = 0;
                data.forEach(item => {
                    // êµ¬í˜• ë°ì´í„° í˜¸í™˜ì„± ì²˜ë¦¬
                    if(!item.dateStr) item.dateStr = item.date || new Date().toLocaleDateString('ko-KR');
                    if(!item.tag) item.tag = "#ë³µì›";
                    store.put(item);
                    count++;
                });

                tx.oncomplete = () => { alert(`ì„±ê³µ! ${count}ê°œì˜ ê¸°ë¡ì„ ë³µì›í–ˆìŠµë‹ˆë‹¤.`); switchTab('list'); };
            } catch (err) { alert("ë³µì› ì‹¤íŒ¨: " + err.message); }
        };
        reader.readAsText(file);
        input.value = '';
    }

    async function saveMemo() {
        const title = document.getElementById('inputTitle').value;
        let content = document.getElementById('inputContent').value;
        if(!title && !content) return alert('ë‚´ìš© ì…ë ¥ í•„ìš”');
        const files = document.getElementById('inputImage').files;
        if(files.length > 0) {
            content += "<br>";
            for(let i=0; i<files.length; i++) {
                const imgData = await compressImage(files[i]);
                content += `<img src="${imgData}" style="max-width:100%; border-radius:8px; margin-top:5px;"><br>`;
            }
        }
        const memo = {
            id: Date.now(), dateStr: new Date().toLocaleDateString('ko-KR'), 
            title: title || "ì œëª© ì—†ìŒ", tag: document.getElementById('inputTag').value,
            content: content, link: document.getElementById('inputLink').value, image: null
        };
        db.transaction(STORE_NAME, 'readwrite').objectStore(STORE_NAME).add(memo).oncomplete = () => { 
            alert('ì €ì¥ë¨'); 
            document.getElementById('inputTitle').value='';
            document.getElementById('inputContent').value='';
            document.getElementById('inputImage').value=''; 
            switchTab('calendar'); renderCalendar(); 
        };
    }

    async function openViewModal(id) {
        const memos = await getAll();
        const m = memos.find(x => x.id === id);
        if(!m) return;
        document.getElementById('viewTitle').innerText = m.title;
        document.getElementById('viewDate').innerText = m.dateStr;
        document.getElementById('viewTag').innerText = m.tag || '#ì¼ë°˜';
        
        // HTML ê·¸ëŒ€ë¡œ ë³´ì—¬ì£¼ê¸° (ì´ë¯¸ì§€ ë Œë”ë§)
        document.getElementById('viewBody').innerHTML = m.content;
        
        const linkBox = document.getElementById('viewLink');
        linkBox.innerHTML = m.link ? `<a href="${m.link}" target="_blank" style="display:block; background:#f1f1f1; padding:10px; border-radius:8px; text-decoration:none; color:#0d47a1;">ğŸ”— ê´€ë ¨ ë§í¬ ì—´ê¸°</a>` : '';
        
        document.getElementById('viewModal').style.display = 'flex';
        // ìˆ˜ì • ëª¨ë“œë¥¼ ìœ„í•´ ID ì €ì¥
        document.getElementById('editId').value = m.id;
    }

    function closeViewModal() { document.getElementById('viewModal').style.display = 'none'; }

    async function switchToEditMode() {
        closeViewModal();
        const id = Number(document.getElementById('editId').value);
        const memos = await getAll();
        const m = memos.find(x => x.id === id);
        if(!m) return;
        document.getElementById('editId').value = m.id;
        document.getElementById('editTitle').value = m.title;
        document.getElementById('editTag').value = m.tag;
        document.getElementById('editContent').value = m.content;
        document.getElementById('editLink').value = m.link;
        document.getElementById('editModal').style.display = 'flex';
    }
    
    function closeEditModal() { document.getElementById('editModal').style.display = 'none'; }
    function updateMemo() {
        const id = Number(document.getElementById('editId').value);
        const store = db.transaction(STORE_NAME, 'readwrite').objectStore(STORE_NAME);
        store.get(id).onsuccess = (e) => {
            const data = e.target.result;
            data.title = document.getElementById('editTitle').value;
            data.tag = document.getElementById('editTag').value;
            data.content = document.getElementById('editContent').value;
            data.link = document.getElementById('editLink').value;
            store.put(data).onsuccess = () => { alert('ìˆ˜ì • ì™„ë£Œ'); closeEditModal(); renderMemos(); renderCalendar(); };
        };
    }
    function getAll() { return new Promise(r => db.transaction(STORE_NAME,'readonly').objectStore(STORE_NAME).getAll().onsuccess = e => r(e.target.result)); }
    async function renderMemos() {
        const list = document.getElementById('memoList'); list.innerHTML='';
        const memos = await getAll();
        const key = document.getElementById('searchInput').value;
        memos.sort((a,b) => b.id - a.id);
        memos.forEach(m => {
            if(key && !m.title.includes(key) && !m.content.includes(key)) return;
            let summary = m.content.replace(/<[^>]*>?/gm, '');
            if(summary.length > 40) summary = summary.substring(0, 40) + "...";
            let thumbnail = m.content.includes('<img') ? '<div style="font-size:0.8rem; color:#27ae60; margin-top:5px;">ğŸ“· ì‚¬ì§„ ìˆìŒ</div>' : '';
            list.innerHTML += `<div class="memo-card" onclick="openViewModal(${m.id})">
                <div style="display:flex; justify-content:space-between; color:#666; font-size:0.8rem;"><span>${m.dateStr}</span><span style="color:var(--accent-color);">${m.tag || '#ì¼ë°˜'}</span></div>
                <h3 style="margin:5px 0; font-size:1.1rem; color:#2c3e50;">${m.title}</h3><p style="color:#555; font-size:0.9rem; margin-bottom:5px;">${summary}</p>${thumbnail}</div>`;
        });
    }
    let currDate = new Date();
    function changeMonth(d) { currDate.setMonth(currDate.getMonth()+d); renderCalendar(); }
    async function renderCalendar() {
        const y = currDate.getFullYear(), m = currDate.getMonth();
        document.getElementById('currentMonth').innerText = `${y}ë…„ ${m+1}ì›”`;
        const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
        'ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† '.split('').forEach(d=>grid.innerHTML+=`<div style="text-align:center; font-size:0.8rem; color:#888;">${d}</div>`);
        const first = new Date(y,m,1).getDay(), last = new Date(y,m+1,0).getDate();
        for(let i=0; i<first; i++) grid.innerHTML+=`<div></div>`;
        const memos = await getAll();
        for(let d=1; d<=last; d++) {
            const checkDate = new Date(y,m,d).toLocaleDateString('ko-KR');
            const has = memos.some(x => x.dateStr.replace(/\s/g,'') === checkDate.replace(/\s/g,''));
            const div = document.createElement('div'); div.className = 'cal-day' + (has ? ' has-memo' : '');
            const today = new Date(); if(y===today.getFullYear() && m===today.getMonth() && d===today.getDate()) div.classList.add('today');
            div.innerHTML = `<span>${d}</span>${has?'<div class="dot"></div>':''}`;
            div.onclick = () => showDayMemos(checkDate, memos);
            grid.appendChild(div);
        }
    }
    function showDayMemos(dateStr, memos) {
        const target = memos.filter(m => m.dateStr.replace(/\s/g, '') === dateStr.replace(/\s/g, ''));
        const box = document.getElementById('calendarMemos');
        if(target.length==0) box.innerHTML = `<p>${dateStr} ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
        else box.innerHTML = `<h4 style="margin:10px 0;">${dateStr} ê¸°ë¡ (${target.length}ê±´)</h4>` + target.map(m=>`<div style="background:#fff; padding:15px; margin-bottom:10px; border-radius:8px; text-align:left; border:1px solid #eee;" onclick="openViewModal(${m.id})"><strong style="display:block; font-size:1.1rem; margin-bottom:5px;">${m.title}</strong><div style="font-size:0.9rem; color:#555;">${m.content.replace(/<[^>]*>?/gm, '').substring(0,30)}...</div>${m.content.includes('<img') ? '<span style="font-size:0.8rem; color:green;">ğŸ“· ì‚¬ì§„ í¬í•¨</span>' : ''}</div>`).join('');
    }
    function compressImage(file) { return new Promise(r => { const reader = new FileReader(); reader.onload = e => { const img = new Image(); img.onload = () => { const c = document.createElement('canvas'); let w=img.width, h=img.height; if(w>1024) { h*=1024/w; w=1024; } c.width=w; c.height=h; c.getContext('2d').drawImage(img,0,0,w,h); r(c.toDataURL('image/jpeg',0.7)); }; img.src = e.target.result; }; reader.readAsDataURL(file); }); }
    function backupData() { getAll().then(memos => { if(memos.length==0) return alert('ë°ì´í„° ì—†ìŒ'); const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(memos)],{type:'application/json'})); a.download = `JDM_Backup_${new Date().toISOString().slice(0,10)}.json`; a.click(); }); }
    function resetApp() { if(confirm('ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { db.transaction(STORE_NAME,'readwrite').objectStore(STORE_NAME).clear().onsuccess=()=>{ alert('ì´ˆê¸°í™” ì™„ë£Œ'); location.reload(); }; } }
</script>
</body>
</html>
