<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JDM Archive v13.7</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #c0392b; --bg-color: #f0f2f5; --card-bg: #ffffff; --nav-height: 65px; --holiday-color: #e74c3c; --sat-color: #2980b9; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg-color); color: #333; margin: 0; padding-bottom: var(--nav-height); -webkit-font-smoothing: antialiased; box-sizing: border-box; }
        *, *:before, *:after { box-sizing: border-box; }

        header { background: var(--primary-color); padding: 15px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; color: white; }
        header h1 { margin: 0; font-size: 1.4rem; font-weight: 700; flex-grow: 1; text-align: center; margin-left: 40px; letter-spacing: -0.5px; }
        
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .tab-content { display: none; animation: fadeIn 0.3s ease; } .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        #loginOverlay input { width: 220px; padding: 15px; font-size: 1.5rem; text-align: center; border-radius: 12px; border: none; margin-top: 10px; letter-spacing: 5px; }
        #loginOverlay button { margin-top: 20px; padding: 12px 40px; background: #c0392b; color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; }

        /* ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
        .calendar-wrapper { background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid #e0e0e0; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); width: 100%; }
        .day-header { text-align: center; font-size: 0.9rem; color: #555; padding: 12px 0; font-weight: 600; background-color: #f8f9fa; border-bottom: 1px solid #e0e0e0; border-right: 1px solid #e0e0e0; }
        .day-header:nth-child(7n) { border-right: none; }
        .day-header.sun { color: var(--holiday-color); }
        .day-header.sat { color: var(--sat-color); }
        
        .cal-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; font-size: 0.95rem; cursor: pointer; padding-top: 6px; transition: background 0.2s; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; background: white; position: relative; }
        .cal-day:nth-child(7n) { border-right: none; }
        .cal-day:hover { background: #fafafa; }
        .cal-day.today { background: #e3f2fd; }
        .cal-day.today .day-num { background: var(--primary-color); color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.85rem; }
        .cal-day.has-memo .day-num { font-weight: bold; text-decoration: underline; text-underline-offset: 3px; }
        .cal-day.active-select { background: #fff0f0; box-shadow: inset 0 0 0 2px var(--accent-color); z-index: 10; }
        .day-num { margin-bottom: 2px; }
        .holiday-name { font-size: 0.7rem; color: var(--holiday-color); font-weight: bold; margin-bottom: 2px; text-align: center; word-break: keep-all; line-height: 1.1; }
        .cal-day.sun .day-num, .cal-day.holiday .day-num { color: var(--holiday-color); }
        .cal-day.sat .day-num { color: var(--sat-color); }
        .dot { width: 6px; height: 6px; background: var(--accent-color); border-radius: 50%; margin-top: 4px; display: block; }
        .cal-events-pc { display: none; width: 100%; margin-top: 2px; padding: 0 2px; box-sizing: border-box; }
        
        @media (min-width: 768px) {
            .cal-day { aspect-ratio: auto; min-height: 130px; height: 100%; align-items: flex-start; padding: 8px; }
            .dot { display: none; } .cal-events-pc { display: block; }
            .cal-event-item { font-size: 0.8rem; background: #f1f3f5; color: #495057; padding: 4px 8px; border-radius: 4px; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-left: 3px solid var(--accent-color); cursor: pointer; transition: background 0.2s; }
            .cal-event-item:hover { background: #e9ecef; color: #000; }
            .more-items { font-size: 0.75rem; color: #888; text-align: right; padding-right: 5px; margin-top: 2px; }
        }

        /* ë©”ëª¨ ì¹´ë“œ */
        .memo-card { background: var(--card-bg); padding: 20px; border-radius: 16px; margin-bottom: 15px; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: transform 0.2s; border: 1px solid #eee; cursor: pointer; }
        .memo-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .memo-card.selected { border: 2px solid var(--accent-color); background: #fff5f5; }
        .check-circle { position: absolute; top: 15px; right: 15px; width: 24px; height: 24px; border-radius: 50%; border: 2px solid #ddd; background: white; display: none; }
        .memo-card.selection-mode .check-circle { display: block; }
        .memo-card.selected .check-circle { background: var(--accent-color); border-color: var(--accent-color); }
        .memo-card.selected .check-circle::after { content: 'âœ”'; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 14px; }

        input, select { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; background: #fff; }
        
        .tag-select-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; padding: 5px 0; }
        .tag-chip-btn {
            padding: 8px 14px; border-radius: 20px; border: 1px solid #ddd; background: #f8f9fa; color: #555; font-size: 0.9rem; cursor: pointer; transition: all 0.2s;
        }
        .tag-chip-btn.active {
            background: var(--primary-color); color: white; border-color: var(--primary-color); font-weight: bold; box-shadow: 0 2px 5px rgba(44, 62, 80, 0.3);
        }
        
        /* [NEW] ê³ ìŠ¤íŠ¸ íƒœê·¸(ë¯¸ë“±ë¡) ìŠ¤íƒ€ì¼ */
        .tag-chip-btn.ghost {
            background: #fff0f0; color: #e74c3c; border: 1px dashed #e74c3c; opacity: 0.8;
        }

        .card-tags { display: flex; gap: 5px; flex-wrap: wrap; margin-left: auto; justify-content: flex-end;}
        .mini-tag { font-size: 0.75rem; background: #e3f2fd; color: var(--sat-color); padding: 2px 8px; border-radius: 12px; font-weight: bold; }

        .rich-editor { width: 100%; min-height: 250px; max-height: 500px; overflow-y: auto; padding: 14px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; background: #fff; line-height: 1.6; outline: none; }
        .rich-editor:focus { border-color: var(--primary-color); }
        .rich-editor img { max-width: 100%; border-radius: 8px; margin: 10px 0; display: block; }
        .rich-editor:empty:before { content: attr(placeholder); color: #aaa; display: block; }

        .btn-save { width: 100%; padding: 16px; background: var(--primary-color); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        
        .search-bar-area { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .search-row { display: flex; gap: 5px; align-items: center; width: 100%; }
        .search-row select { flex-grow: 1; margin-bottom: 0; }
        .search-row input { flex-grow: 2; margin-bottom: 0; }
        .icon-btn { background: #95a5a6; color: white; border: none; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 1.2rem; min-width: 45px; }
        .btn-select-mode { background: #2c3e50; }
        .btn-select-mode.active { background: var(--accent-color); box-shadow: inset 0 3px 5px rgba(0,0,0,0.2); }
        .date-filter-row { display: flex; gap: 5px; align-items: center; }
        .date-filter-row input[type="date"] { margin-bottom: 0; font-size: 0.9rem; padding: 8px; }

        #bulkDeleteBar { position: fixed; bottom: var(--nav-height); left: 0; width: 100%; background: var(--accent-color); color: white; padding: 15px; text-align: center; font-weight: bold; cursor: pointer; display: none; z-index: 900; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:2000; align-items:center; justify-content:center; backdrop-filter: blur(4px); }
        .modal-content { background:white; width:90%; max-width:550px; padding:30px; border-radius:20px; max-height:85vh; overflow-y:auto; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .close-btn { font-size: 2rem; border: none; background: none; cursor: pointer; color: #aaa; line-height: 1; margin-left: 10px;}
        .tag-list { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .tag-item { background: #f1f3f5; padding: 8px 12px; border-radius: 20px; display: flex; align-items: center; gap: 5px; font-size: 0.9rem; }
        .tag-del-btn { color: #e74c3c; font-weight: bold; cursor: pointer; margin-left: 5px; }
        #editPopup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#f0f2f5; z-index:3000; overflow-y:auto; padding-bottom: 50px;}
        .edit-container { max-width:800px; margin:20px auto; padding:20px; background:white; border-radius:15px; box-shadow:0 0 20px rgba(0,0,0,0.1); }
        .edit-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px; }
        .modal-actions { display: flex; align-items: center; gap: 8px; }
        .action-btn { padding: 8px 12px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; border: none; color: white; font-weight: bold; }
        .btn-edit-modal { background: #f39c12; }
        .btn-del-modal { background: #e74c3c; }
        .btn-share-modal { background: #3498db; font-size: 1.1rem; padding: 6px 12px; }
        .view-body { line-height: 1.7; white-space: pre-wrap; font-size: 1.05rem; }
        .view-body img { max-width: 100%; border-radius: 10px; margin: 15px 0; display:block; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; display: flex; border-top: 1px solid #eee; z-index: 1000; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; text-align: center; padding: 10px; color: #999; font-size: 0.75rem; cursor: pointer; }
        .nav-item.active { color: var(--primary-color); font-weight: bold; }
        .nav-icon { font-size: 1.5rem; display: block; margin-bottom: 4px; }
    </style>
</head>
<body>
<div id="loginOverlay">
    <form onsubmit="event.preventDefault(); checkPass();" style="text-align:center;">
        <h2>ğŸ”’ JDM Archive</h2>
        <p>Access Verification</p>
        <input type="password" id="passInput" maxlength="4" placeholder="****">
        <br>
        <button type="submit">ENTER</button>
    </form>
</div>

<header>
    <h1>JDM Archive v13.7</h1>
    <button onclick="changePassword()" style="background:none; border:none; font-size:1.5rem; cursor:pointer; padding:5px; color:rgba(255,255,255,0.8);">ğŸ”’</button>
</header>

<div class="container">
    <div id="tab-calendar" class="tab-content active">
        <div style="display:flex; justify-content:space-between; align-items:center; background:var(--card-bg); padding:15px; border-radius:12px; margin-bottom:15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
            <button onclick="changeMonth(-1)" style="border:none; background:none; font-size:1.5rem; cursor:pointer; color:var(--primary-color);">â—€</button>
            <h2 id="currentMonth" style="margin:0; font-size:1.3rem; color:var(--primary-color);"></h2>
            <button onclick="changeMonth(1)" style="border:none; background:none; font-size:1.5rem; cursor:pointer; color:var(--primary-color);">â–¶</button>
        </div>
        <div class="calendar-wrapper">
            <div id="calendarGrid" class="calendar-grid"></div>
        </div>
        <div id="calendarMemos" style="margin-top:20px; text-align:center; color:#888;"></div>
    </div>

    <div id="tab-list" class="tab-content">
        <div class="search-bar-area">
            <div class="search-row">
                <button class="icon-btn btn-tag-config" onclick="openTagManager()" title="íƒœê·¸ ê´€ë¦¬">âš™ï¸</button>
                <button class="icon-btn btn-select-mode" id="selectModeBtn" onclick="toggleSelectMode()" title="ì„ íƒ ëª¨ë“œ (ì‚­ì œ)">âœ…</button>
                <select id="listFilter" onchange="renderMemos()">
                    <option value="all">ì „ì²´ë³´ê¸°</option>
                </select>
            </div>
            <div class="search-row">
                <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´..." onkeyup="renderMemos()">
            </div>
            <div class="date-filter-row">
                <input type="date" id="filterStartDate" onchange="renderMemos()" title="ì‹œì‘ì¼">
                <span>~</span>
                <input type="date" id="filterEndDate" onchange="renderMemos()" title="ì¢…ë£Œì¼">
            </div>
        </div>
        <div id="memoList"></div>
    </div>

    <div id="tab-write" class="tab-content">
        <div style="background:var(--card-bg); padding:25px; border-radius:16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0; color:var(--primary-color);">ğŸ“ ìƒˆ ê¸°ë¡ ì‘ì„±</h3>
                <button onclick="switchTab('calendar')" style="border:none; background:none; font-size:2rem; cursor:pointer; color:#aaa; line-height:1;">Ã—</button>
            </div>
            <input type="text" id="inputTitle" placeholder="ì œëª©">
            <div style="margin-bottom:12px;">
                <label style="font-size:0.85rem; color:#666; font-weight:bold;">ë‚ ì§œ</label>
                <input type="date" id="inputDate" style="margin-bottom:0;">
            </div>
            <div style="margin-bottom:12px;">
                <label style="font-size:0.85rem; color:#666; font-weight:bold;">íƒœê·¸ ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</label>
                <div id="inputTagContainer" class="tag-select-container"></div>
            </div>
            
            <div id="inputContent" class="rich-editor" contenteditable="true" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”. ì‚¬ì§„ì€ í•˜ë‹¨ ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€í•˜ë©´ ì»¤ì„œ ìœ„ì¹˜ì— ë“¤ì–´ê°‘ë‹ˆë‹¤."></div>
            <input type="text" id="inputLink" placeholder="ê´€ë ¨ ë§í¬ (URL)">
            <div style="margin:20px 0;">
                <label style="display:block; margin-bottom:8px; font-weight:bold; color:#555;">ğŸ“¸ ì‚¬ì§„ ì¶”ê°€ (ë³¸ë¬¸ì— ì‚½ì…ë¨)</label>
                <input type="file" id="inputImage" accept="image/*" multiple style="padding:12px; background:#f8f9fa; width:100%;" onchange="insertImageToEditor(this, 'inputContent')">
            </div>
            <button class="btn-save" onclick="saveNewMemo()">ì € ì¥ í•˜ ê¸°</button>
        </div>
    </div>

    <div id="tab-data" class="tab-content">
        <div style="background:var(--card-bg); padding:25px; border-radius:16px; text-align:center; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
            <h3>ğŸ’¾ ë°ì´í„° ì„¼í„°</h3>
             <div style="background:#fff3cd; padding:20px; border-radius:12px; margin-bottom:20px; border:2px solid #ffc107; text-align:left;">
                <strong style="color:#d35400;">ğŸ“‚ ë°±ì—… íŒŒì¼ë¡œ ë³µì›</strong>
                <input type="file" id="restoreInput" onchange="restoreData(this)" style="background:white; border:1px solid #ccc; width:100%; margin-top:10px;">
                <p style="font-size:0.8rem; color:#666; margin-top:5px;">â€» ë©”ëª¨ì™€ íƒœê·¸ ì„¤ì •ì´ ëª¨ë‘ ë³µì›ë©ë‹ˆë‹¤.</p>
            </div>
            <button onclick="backupData()" class="btn-save" style="background:#27ae60; margin-bottom:12px;">ğŸ“¤ ì „ì²´ ë°ì´í„° ë°±ì—…</button>
            <button onclick="resetApp()" class="btn-save" style="background:#7f8c8d;">âš ï¸ ì•± ì´ˆê¸°í™”</button>
        </div>
    </div>
</div>

<div id="bulkDeleteBar" onclick="deleteSelectedMemos()">
    ğŸ—‘ï¸ ì„ íƒí•œ í•­ëª© ì‚­ì œí•˜ê¸° (<span id="selectedCount">0</span>)
</div>

<div id="tagManagerModal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <h2 style="margin:0;">âš™ï¸ íƒœê·¸ ê´€ë¦¬</h2>
            <button class="close-btn" onclick="closeTagManager()">Ã—</button>
        </div>
        <div id="tagListDisplay" class="tag-list"></div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="newTagInput" placeholder="#ìƒˆíƒœê·¸" style="margin:0;">
            <button class="btn-save" onclick="addNewTag()" style="padding:10px; width:auto;">ì¶”ê°€</button>
        </div>
    </div>
</div>

<div id="editPopup">
    <div class="edit-container">
        <div class="edit-header">
            <h2 style="margin:0; color:#2c3e50;">âœï¸ ë‚´ìš© ìˆ˜ì •</h2>
            <button onclick="closeEditPopup()" style="border:none; background:none; font-size:1.5rem; cursor:pointer;">âœ–</button>
        </div>
        <input type="hidden" id="editId">
        <label>ì œëª©</label>
        <input type="text" id="editTitle">
        <div style="margin-bottom:12px;">
            <label>ë‚ ì§œ (ìˆ˜ì • ê°€ëŠ¥)</label>
            <input type="date" id="editDate" style="margin-bottom:0;">
        </div>
        <div style="margin-bottom:12px;">
            <label>íƒœê·¸ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</label>
            <div id="editTagContainer" class="tag-select-container"></div>
        </div>
        <label>ë‚´ìš© (ì‚¬ì§„ í¸ì§‘ ê°€ëŠ¥)</label>
        <div id="editContent" class="rich-editor" contenteditable="true"></div>
        <label>ë§í¬</label>
        <input type="text" id="editLink">
        <label>ì‚¬ì§„ ì¶”ê°€ (ì»¤ì„œ ìœ„ì¹˜ì— ì‚½ì…)</label>
        <input type="file" id="editImageFile" accept="image/*" multiple style="padding:10px; background:#eee; width:100%; margin-bottom:20px;" onchange="insertImageToEditor(this, 'editContent')">
        <div style="display:flex; gap:10px;">
            <button class="btn-save" style="background:#f39c12; flex:2;" onclick="saveEditedMemo()">ìˆ˜ì • ì™„ë£Œ</button>
            <button class="btn-save" style="background:#95a5a6; flex:1;" onclick="closeEditPopup()">ì·¨ì†Œ</button>
        </div>
    </div>
</div>

<div id="viewModal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:15px;">
            <div style="display:flex; flex-direction:column; gap:5px;">
                <div id="viewTagList" style="display:flex; gap:5px; flex-wrap:wrap;"></div>
                <span id="viewDate" style="color:#888; font-size:0.95rem;"></span>
            </div>
            <div class="modal-actions">
                <input type="hidden" id="viewIdHidden">
                <button class="action-btn btn-share-modal" onclick="shareCurrentMemo()" title="ë‚´ìš© ê³µìœ (í…ìŠ¤íŠ¸)">ğŸ“¤</button>
                <button class="action-btn btn-edit-modal" onclick="transferToEdit()">ìˆ˜ì •</button>
                <button class="action-btn btn-del-modal" onclick="deleteFromView()">ì‚­ì œ</button>
                <button class="close-btn" onclick="closeViewModal()">Ã—</button>
            </div>
        </div>
        <h2 id="viewTitle" style="margin-top:0; color:#2c3e50; line-height:1.3;"></h2>
        <div id="viewBody" class="view-body"></div>
        <div id="viewLink" style="margin-top:25px;"></div>
        <button class="btn-save" onclick="closeViewModal()" style="background:#999; margin-top:25px;">ë‹« ê¸°</button>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('calendar')"><span class="nav-icon">ğŸ“…</span>í™ˆ</div>
    <div class="nav-item" onclick="switchTab('list')"><span class="nav-icon">ğŸ“‹</span>ëª©ë¡</div>
    <div class="nav-item" onclick="switchTab('write')"><span class="nav-icon">âœï¸</span>ê¸°ë¡</div>
    <div class="nav-item" onclick="switchTab('data')"><span class="nav-icon">ğŸ’¾</span>ë°ì´í„°</div>
</nav>

<script>
    const DB_NAME = 'JeongArchiveDB_v9';
    const STORE_NAME = 'memos';
    let db;
    let currDate = new Date();
    let myTags = JSON.parse(localStorage.getItem('myTags')) || ['#ì¼ë°˜','#ì—…ë¬´','#ì•„ì´ë””ì–´','#ê±´ê°•','#í˜„ì¥','#AI','#ì‹¬ë¦¬'];
    let isSelectionMode = false;
    let selectedIds = new Set();
    let currentSelectedDateKey = null;

    let inputSelectedTags = new Set();
    let editSelectedTags = new Set();

    const HOLIDAYS = {
        '2025-01-01': 'ì‹ ì •', '2025-01-28': 'ì„¤ë‚ ', '2025-01-29': 'ì„¤ë‚ ', '2025-01-30': 'ì„¤ë‚ ',
        '2025-03-01': 'ì‚¼ì¼ì ˆ', '2025-05-05': 'ì–´ë¦°ì´ë‚ ', '2025-05-06': 'ì„ê°€íƒ„ì‹ ì¼',
        '2025-06-06': 'í˜„ì¶©ì¼', '2025-08-15': 'ê´‘ë³µì ˆ', '2025-10-03': 'ê°œì²œì ˆ',
        '2025-10-05': 'ì¶”ì„', '2025-10-06': 'ì¶”ì„', '2025-10-07': 'ì¶”ì„', '2025-10-08': 'ëŒ€ì²´ê³µíœ´ì¼',
        '2025-10-09': 'í•œê¸€ë‚ ', '2025-12-25': 'ì„±íƒ„ì ˆ',
        '2026-01-01': 'ì‹ ì •', '2026-02-16': 'ì„¤ë‚ ', '2026-02-17': 'ì„¤ë‚ ', '2026-02-18': 'ì„¤ë‚ ',
        '2026-03-01': 'ì‚¼ì¼ì ˆ', '2026-05-05': 'ì–´ë¦°ì´ë‚ ', '2026-05-24': 'ì„ê°€íƒ„ì‹ ì¼',
        '2026-06-06': 'í˜„ì¶©ì¼', '2026-08-15': 'ê´‘ë³µì ˆ', '2026-09-24': 'ì¶”ì„',
        '2026-09-25': 'ì¶”ì„', '2026-09-26': 'ì¶”ì„', '2026-10-03': 'ê°œì²œì ˆ',
        '2026-10-09': 'í•œê¸€ë‚ ', '2026-12-25': 'ì„±íƒ„ì ˆ'
    };

    function getPassword() { return localStorage.getItem('appPass') || "0403"; }
    function checkPass() {
        if(document.getElementById('passInput').value === getPassword()) {
            document.getElementById('loginOverlay').style.opacity = '0';
            setTimeout(() => { document.getElementById('loginOverlay').style.display = 'none'; }, 300);
        } else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.'); document.getElementById('passInput').value=''; }
    }
    function changePassword() {
        const cur = prompt("í˜„ì¬ ë¹„ë°€ë²ˆí˜¸:"); if(cur!==getPassword()) return alert("í‹€ë ¸ìŠµë‹ˆë‹¤.");
        const newP = prompt("ìƒˆ ë¹„ë°€ë²ˆí˜¸:"); if(newP) { localStorage.setItem('appPass', newP); alert("ë³€ê²½ ì™„ë£Œ."); }
    }

    const request = indexedDB.open(DB_NAME, 1);
    request.onupgradeneeded = e => { db = e.target.result; if(!db.objectStoreNames.contains(STORE_NAME)) db.createObjectStore(STORE_NAME, {keyPath:'id'}); };
    request.onsuccess = e => { db = e.target.result; initApp(); };

    function initApp() { 
        updateTagSelects(); 
        document.getElementById('inputDate').value = new Date().toISOString().substring(0, 10);
        renderCalendar(); 
        renderMemos(); 
    }

    function openTagManager() { renderTagListModal(); document.getElementById('tagManagerModal').style.display = 'flex'; }
    function closeTagManager() { document.getElementById('tagManagerModal').style.display = 'none'; }
    function renderTagListModal() { document.getElementById('tagListDisplay').innerHTML = myTags.map(t => `<span class="tag-item">${t} <span class="tag-del-btn" onclick="removeTag('${t}')">Ã—</span></span>`).join(''); }
    function addNewTag() { const val = document.getElementById('newTagInput').value.trim(); if(!val) return; if(!myTags.includes(val)) { myTags.push(val); saveTags(); document.getElementById('newTagInput').value = ''; renderTagListModal(); updateTagSelects(); } }
    
    // [ìˆ˜ì •] íƒœê·¸ ì‚­ì œ ë¡œì§ ê°•í™”
    function removeTag(tag) { 
        if(confirm('ì‚­ì œí•©ë‹ˆê¹Œ?')) { 
            myTags = myTags.filter(t => t !== tag); 
            saveTags(); 
            renderTagListModal(); 
            updateTagSelects(); 
        } 
    }
    function saveTags() { localStorage.setItem('myTags', JSON.stringify(myTags)); }

    // [NEW] íƒœê·¸ ì„ íƒê¸° (ê³ ìŠ¤íŠ¸ íƒœê·¸ ì²˜ë¦¬ í¬í•¨)
    function renderTagSelector(containerId, selectedSet) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        // 1. ì •ìƒ ë“±ë¡ëœ íƒœê·¸ ë²„íŠ¼ ìƒì„±
        myTags.forEach(tag => {
            createChip(container, tag, selectedSet, false);
        });

        // 2. ê³ ìŠ¤íŠ¸ íƒœê·¸ íƒì§€ (ëª©ë¡ì—” ì—†ëŠ”ë° ì„ íƒëœ íƒœê·¸)
        selectedSet.forEach(tag => {
            if (!myTags.includes(tag)) {
                createChip(container, tag, selectedSet, true);
            }
        });
    }

    function createChip(container, tag, selectedSet, isGhost) {
         const btn = document.createElement('span');
         // ê³ ìŠ¤íŠ¸ íƒœê·¸ë©´ ë¹¨ê°„ ì ì„  ìŠ¤íƒ€ì¼ ì ìš©
         btn.className = 'tag-chip-btn' + (selectedSet.has(tag) ? ' active' : '') + (isGhost ? ' ghost' : '');
         btn.innerText = tag + (isGhost ? ' (ë¯¸ë“±ë¡)' : '');
         btn.onclick = () => {
             if(selectedSet.has(tag)) selectedSet.delete(tag);
             else selectedSet.add(tag);
             
             // ê³ ìŠ¤íŠ¸ íƒœê·¸ë¥¼ í•´ì œí•˜ë©´ ì¦‰ì‹œ UIì—ì„œ ì‚¬ë¼ì§ (ì˜êµ¬ ì‚­ì œ)
             renderTagSelector(container.id, selectedSet); 
         };
         container.appendChild(btn);
    }

    function updateTagSelects() {
        const opts = myTags.map(t => `<option value="${t}">${t}</option>`).join('');
        const curFilter = document.getElementById('listFilter').value;
        document.getElementById('listFilter').innerHTML = `<option value="all">ì „ì²´ë³´ê¸°</option>` + opts;
        document.getElementById('listFilter').value = curFilter;

        renderTagSelector('inputTagContainer', inputSelectedTags);
        renderTagSelector('editTagContainer', editSelectedTags);
    }

    function toggleSelectMode() {
        isSelectionMode = !isSelectionMode;
        selectedIds.clear(); 
        const btn = document.getElementById('selectModeBtn');
        const bulkBar = document.getElementById('bulkDeleteBar');
        if(isSelectionMode) { btn.classList.add('active'); bulkBar.style.display = 'block'; updateBulkBar(); } else { btn.classList.remove('active'); bulkBar.style.display = 'none'; }
        renderMemos(); 
    }
    function toggleSelectCard(id) { if(selectedIds.has(id)) selectedIds.delete(id); else selectedIds.add(id); renderMemos(); updateBulkBar(); }
    function updateBulkBar() { document.getElementById('selectedCount').innerText = selectedIds.size; }
    function deleteSelectedMemos() {
        if(selectedIds.size === 0) return alert("í•­ëª© ì„ íƒ í•„ìš”");
        if(!confirm(`ì„ íƒí•œ ${selectedIds.size}ê°œ í•­ëª© ì‚­ì œ?`)) return;
        const tx = db.transaction(STORE_NAME, 'readwrite');
        selectedIds.forEach(id => tx.objectStore(STORE_NAME).delete(id));
        tx.oncomplete = () => { alert("ì‚­ì œë¨"); toggleSelectMode(); renderMemos(); renderCalendar(); };
    }

    function switchTab(tab) {
        window.scrollTo(0, 0); 
        document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
        document.getElementById('tab-'+tab).classList.add('active');
        const tabs = ['calendar','list','write','data'];
        document.querySelectorAll('.nav-item')[tabs.indexOf(tab)].classList.add('active');
        
        if(tab === 'list') renderMemos();
        if(tab === 'calendar') {
            currDate = new Date(); 
            renderCalendar();      
        }
    }

    function strToInputDate(str) {
        if(!str) return "";
        const digits = str.replace(/\D/g, ''); 
        if(digits.length < 8) {
            const parts = str.match(/\d+/g);
            if(!parts || parts.length < 3) return "";
            const y = parts[0];
            const m = parts[1].padStart(2,'0');
            const d = parts[2].padStart(2,'0');
            return `${y}-${m}-${d}`;
        }
        return `${digits.slice(0,4)}-${digits.slice(4,6)}-${digits.slice(6,8)}`;
    }
    function inputDateToStr(val) {
        if(!val) return "";
        const parts = val.split('-'); 
        return `${parts[0]}. ${Number(parts[1])}. ${Number(parts[2])}.`;
    }
    function normalizeDate(str) {
        if(!str) return "";
        const parts = str.match(/\d+/g);
        if(!parts || parts.length < 3) return "";
        const y = parts[0];
        const m = parts[1].padStart(2,'0');
        const d = parts[2].padStart(2,'0');
        return `${y}${m}${d}`;
    }

    function openWriteWithDate(y, m, d) {
        const dateStr = `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        document.getElementById('inputDate').value = dateStr;
        switchTab('write');
    }

    async function insertImageToEditor(input, editorId) {
        const files = input.files;
        if(files.length === 0) return;
        const editor = document.getElementById(editorId);
        for(let i=0; i<files.length; i++) {
            const imgData = await compressImage(files[i]);
            const img = document.createElement('img');
            img.src = imgData;
            editor.appendChild(img);
            const br = document.createElement('br');
            editor.appendChild(br);
        }
        input.value = ''; 
    }

    function getTagsFromMemo(memo) {
        if(memo.tags && Array.isArray(memo.tags)) return memo.tags; 
        if(memo.tag) return [memo.tag]; 
        return [];
    }

    async function saveNewMemo() {
        const title = document.getElementById('inputTitle').value;
        const finalContent = document.getElementById('inputContent').innerHTML;
        const tags = Array.from(inputSelectedTags);
        const link = document.getElementById('inputLink').value;
        const dateVal = document.getElementById('inputDate').value;
        const pureText = document.getElementById('inputContent').innerText.trim();
        const hasImg = finalContent.includes('<img');

        if(!title && !pureText && !hasImg) return alert('ë‚´ìš© í•„ìš”');
        
        const store = db.transaction(STORE_NAME, 'readwrite').objectStore(STORE_NAME);
        store.add({
            id: Date.now(),
            dateStr: inputDateToStr(dateVal), 
            title: title || "ë¬´ì œ",
            tags: tags, 
            content: finalContent, link: link
        }).onsuccess = () => {
            alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            document.getElementById('inputTitle').value = "";
            document.getElementById('inputContent').innerHTML = ""; 
            document.getElementById('inputLink').value = "";
            document.getElementById('inputDate').value = new Date().toISOString().substring(0, 10);
            
            inputSelectedTags.clear();
            renderTagSelector('inputTagContainer', inputSelectedTags);

            switchTab('calendar'); 
        };
    }

    function transferToEdit() { const id = Number(document.getElementById('viewIdHidden').value); closeViewModal(); openEditPopup(id); }
    function deleteFromView() {
        const id = Number(document.getElementById('viewIdHidden').value);
        if(confirm('ì‚­ì œ?')) {
            db.transaction(STORE_NAME, 'readwrite').objectStore(STORE_NAME).delete(id).onsuccess = () => {
                alert('ì‚­ì œë¨'); closeViewModal(); renderMemos(); renderCalendar();
            };
        }
    }

    async function shareCurrentMemo() {
        const id = Number(document.getElementById('viewIdHidden').value);
        const m = await getMemo(id);
        if(!m) return;
        const pureText = m.content.replace(/<br\s*\/?>/gi, "\n").replace(/<[^>]*>/g, "");
        const tags = getTagsFromMemo(m).join(' ');
        const shareData = {
            title: m.title,
            text: `[${m.title}] (${m.dateStr})\n\n${pureText}\n\n${tags}`
        };
        if (navigator.share) {
            try { await navigator.share(shareData); } catch (err) {}
        } else {
            const clipText = `${shareData.title}\n\n${shareData.text}`;
            navigator.clipboard.writeText(clipText).then(() => { alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n(ì¹´í†¡ ë“±ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”)'); });
        }
    }

    function openEditPopup(id) {
        getMemo(id).then(m => {
            if(!m) return;
            document.getElementById('editId').value = m.id;
            document.getElementById('editTitle').value = m.title;
            document.getElementById('editDate').value = strToInputDate(m.dateStr);
            
            editSelectedTags = new Set(getTagsFromMemo(m));
            renderTagSelector('editTagContainer', editSelectedTags);

            document.getElementById('editLink').value = m.link;
            document.getElementById('editContent').innerHTML = m.content;
            document.getElementById('editPopup').style.display = 'block';
        });
    }

    async function saveEditedMemo() {
        const id = Number(document.getElementById('editId').value);
        const title = document.getElementById('editTitle').value;
        const finalContent = document.getElementById('editContent').innerHTML;
        const tags = Array.from(editSelectedTags);
        const link = document.getElementById('editLink').value;
        const dateVal = document.getElementById('editDate').value; 
        
        const original = await getMemo(id);
        const updatedMemo = { 
            id: id, 
            dateStr: inputDateToStr(dateVal), 
            title: title, 
            tags: tags, 
            content: finalContent, 
            link: link 
        };
        
        db.transaction(STORE_NAME, 'readwrite').objectStore(STORE_NAME).put(updatedMemo).onsuccess = () => {
            alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!'); closeEditPopup(); renderMemos(); renderCalendar();
        };
    }
    function closeEditPopup() { document.getElementById('editPopup').style.display = 'none'; }

    function checkDateRange(targetStr, start, end) {
        if(!targetStr) return false;
        const targetNum = parseInt(normalizeDate(targetStr));
        const startNum = start ? parseInt(start.replace(/-/g, '')) : 0;
        const endNum = end ? parseInt(end.replace(/-/g, '')) : 99999999;
        return targetNum >= startNum && targetNum <= endNum;
    }

    async function renderMemos() {
        const list = document.getElementById('memoList'); list.innerHTML='';
        const memos = await getAll();
        const filter = document.getElementById('listFilter').value;
        const key = document.getElementById('searchInput').value;
        const startVal = document.getElementById('filterStartDate').value;
        const endVal = document.getElementById('filterEndDate').value;
        
        memos.sort((a,b) => b.id - a.id);
        
        memos.forEach(m => {
            const memoTags = getTagsFromMemo(m);
            if(filter !== 'all' && !memoTags.includes(filter)) return;
            
            if(key && !m.title.includes(key) && !m.content.includes(key)) return;
            if(startVal || endVal) {
                if(!checkDateRange(m.dateStr, startVal, endVal)) return;
            }
            
            let summary = m.content.replace(/<[^>]*>?/gm, '').substring(0, 40) + "...";
            let hasImg = m.content.includes('<img') ? 'ğŸ“·' : '';
            
            const tagsHtml = memoTags.map(t => `<span class="mini-tag">${t}</span>`).join('');

            const isSelected = selectedIds.has(m.id);
            const selectClass = isSelected ? 'selected' : '';
            const modeClass = isSelectionMode ? 'selection-mode' : '';
            const clickAction = isSelectionMode ? `toggleSelectCard(${m.id})` : `openViewModal(${m.id})`;

            list.innerHTML += `
            <div class="memo-card ${selectClass} ${modeClass}" onclick="${clickAction}">
                <div class="check-circle"></div>
                <div style="display:flex; justify-content:space-between; align-items:center; color:#888; font-size:0.8rem; margin-bottom:5px;">
                    <span>${m.dateStr}</span>
                    <div class="card-tags">${tagsHtml}</div>
                </div>
                <h3 style="margin:5px 0; font-size:1.1rem; color:#2c3e50;">${m.title} <span style="font-size:0.8rem;">${hasImg}</span></h3>
                <p style="color:#666; font-size:0.9rem; margin:0;">${summary}</p>
            </div>`;
        });
    }

    async function renderCalendar() {
        const y = currDate.getFullYear(), m = currDate.getMonth();
        document.getElementById('currentMonth').innerText = `${y}ë…„ ${m+1}ì›”`;
        const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
        
        const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
        days.forEach((d, idx) => {
            let className = 'day-header';
            if(idx === 0) className += ' sun';
            if(idx === 6) className += ' sat';
            grid.innerHTML += `<div class="${className}">${d}</div>`;
        });

        const first = new Date(y,m,1).getDay(), last = new Date(y,m+1,0).getDate();
        for(let i=0; i<first; i++) grid.innerHTML += `<div></div>`;
        
        const memos = await getAll();
        
        for(let d=1; d<=last; d++) {
            const dateObj = new Date(y, m, d);
            const dayOfWeek = dateObj.getDay(); 
            const targetStr = `${y}${String(m+1).padStart(2,'0')}${String(d).padStart(2,'0')}`;
            const isoStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`; 
            
            const dayMemos = memos.filter(memo => normalizeDate(memo.dateStr) === targetStr);
            const isSelected = (currentSelectedDateKey === targetStr);
            
            const holidayName = HOLIDAYS[isoStr];
            let extraClass = '';
            if(dayOfWeek === 0) extraClass = ' sun';
            else if(dayOfWeek === 6) extraClass = ' sat';
            if(holidayName) extraClass += ' holiday'; 

            const div = document.createElement('div');
            div.className = 'cal-day' + extraClass + (dayMemos.length>0 ? ' has-memo' : '') + (isSelected ? ' active-select' : '');
            
            if(y===new Date().getFullYear() && m===new Date().getMonth() && d===new Date().getDate()) div.classList.add('today');
            
            let pcEvents = '';
            const limit = 3;
            dayMemos.slice(0, limit).forEach(dm => { 
                pcEvents += `<div class="cal-event-item" onclick="event.stopPropagation(); openViewModal(${dm.id})">${dm.title}</div>`; 
            });
            if(dayMemos.length > limit) pcEvents += `<div class="more-items">+${dayMemos.length - limit} ë”ë³´ê¸°</div>`;

            const holidayHtml = holidayName ? `<div class="holiday-name">${holidayName}</div>` : '';

            div.innerHTML = `<span class="day-num">${d}</span>${holidayHtml}${dayMemos.length>0?'<div class="dot"></div>':''}<div class="cal-events-pc">${pcEvents}</div>`;
            
            if (dayMemos.length === 0) {
                div.onclick = () => openWriteWithDate(y, m+1, d);
            } else {
                div.onclick = () => showDayMemos(targetStr, memos);
            }
            grid.appendChild(div);
        }

        const currentMonthKey = `${y}${String(m+1).padStart(2,'0')}`;
        const box = document.getElementById('calendarMemos');

        if (currentSelectedDateKey && currentSelectedDateKey.startsWith(currentMonthKey)) {
            refreshBottomList(currentSelectedDateKey, memos);
        } else {
            box.innerHTML = '';
        }
    }

    function refreshBottomList(targetKey, memos) {
        const target = memos.filter(m => normalizeDate(m.dateStr) === targetKey);
        const box = document.getElementById('calendarMemos');
        const y = targetKey.substring(0, 4);
        const m = targetKey.substring(4, 6);
        const d = targetKey.substring(6, 8);
        const dateObj = new Date(y, m - 1, d);
        const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        const dayName = dayNames[dateObj.getDay()];
        const fancyDate = `${y}ë…„ ${Number(m)}ì›” ${Number(d)}ì¼ (${dayName})`;

        let html = `<div style="text-align:left; background:#fff; padding:15px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
            <h3 style="margin:0 0 15px 0; font-size:1.1rem; color:#2c3e50; border-bottom:2px solid var(--accent-color); padding-bottom:8px;">ğŸ“… ${fancyDate}</h3>`;

        if(target.length === 0) { 
            html += `<p style="color:#888;">ì‘ì„±ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>`; 
        } else {
            html += target.map(m => {
                const tags = getTagsFromMemo(m).map(t => `<span class="mini-tag">${t}</span>`).join(' ');
                return `<div onclick="openViewModal(${m.id})" style="padding:10px; border-bottom:1px solid #eee; cursor:pointer; display:flex; align-items:center;">
                    <div style="flex-shrink:0; margin-right:10px; display:flex; gap:3px;">${tags}</div>
                    <span style="flex-grow:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${m.title}</span>
                </div>`
            }).join('');
        }
        html += `</div>`;
        box.innerHTML = html;
    }

    function showDayMemos(targetKey, memos) {
        currentSelectedDateKey = targetKey;
        renderCalendar(); 
    }

    async function openViewModal(id) {
        const m = await getMemo(id);
        if(!m) return;
        document.getElementById('viewIdHidden').value = m.id;
        document.getElementById('viewTitle').innerText = m.title;
        document.getElementById('viewDate').innerText = m.dateStr;
        
        const tagsHtml = getTagsFromMemo(m).map(t => `<span class="mini-tag" style="background:var(--accent-color); color:white; padding:5px 10px; font-size:0.85rem;">${t}</span>`).join('');
        document.getElementById('viewTagList').innerHTML = tagsHtml;
        
        document.getElementById('viewBody').innerHTML = m.content;
        document.getElementById('viewLink').innerHTML = m.link ? `<a href="${m.link}" target="_blank" style="display:block; background:#f1f5f9; padding:12px; border-radius:8px; text-decoration:none; color:#2980b9; font-weight:bold; text-align:center;">ğŸ”— ê´€ë ¨ ë§í¬ ë°”ë¡œê°€ê¸°</a>` : '';
        document.getElementById('viewModal').style.display = 'flex';
    }
    function closeViewModal() { document.getElementById('viewModal').style.display = 'none'; }
    
    function getMemo(id) { return new Promise(r => db.transaction(STORE_NAME).objectStore(STORE_NAME).get(id).onsuccess = e => r(e.target.result)); }
    function getAll() { return new Promise(r => db.transaction(STORE_NAME,'readonly').objectStore(STORE_NAME).getAll().onsuccess = e => r(e.target.result)); }
    function compressImage(file) { return new Promise(r => { const reader = new FileReader(); reader.onload = e => { const img = new Image(); img.onload = () => { const c = document.createElement('canvas'); let w=img.width, h=img.height; if(w>1024) { h*=1024/w; w=1024; } c.width=w; c.height=h; c.getContext('2d').drawImage(img,0,0,w,h); r(c.toDataURL('image/jpeg',0.7)); }; img.src = e.target.result; }; reader.readAsDataURL(file); }); }
    function changeMonth(d) { currDate.setMonth(currDate.getMonth()+d); renderCalendar(); }
    
    function backupData() { 
        getAll().then(memos => { 
            if(memos.length==0 && myTags.length == 0) return alert('ë°ì´í„° ì—†ìŒ'); 
            const backupObj = {
                version: "v13.7", 
                savedAt: new Date().toISOString(),
                memos: memos,
                tags: myTags 
            };
            const a = document.createElement('a'); 
            a.href = URL.createObjectURL(new Blob([JSON.stringify(backupObj)],{type:'application/json'})); 
            a.download = `JDM_Backup_${new Date().toISOString().slice(0,10)}.json`; 
            a.click(); 
        }); 
    }

    function resetApp() { if(confirm('ì •ë§ ì´ˆê¸°í™”?')) { db.transaction(STORE_NAME,'readwrite').objectStore(STORE_NAME).clear().onsuccess=()=>{ alert('ì´ˆê¸°í™” ì™„ë£Œ'); location.reload(); }; } }
    
    function restoreData(input) { 
        const file = input.files[0]; 
        if(!file) return; 
        const reader = new FileReader(); 
        reader.onload = e => { 
            try { 
                let data = JSON.parse(e.target.result); 
                let memoList = [];
                if (data.memos && Array.isArray(data.memos)) {
                    memoList = data.memos;
                    if (data.tags && Array.isArray(data.tags)) {
                        myTags = data.tags;
                        saveTags(); 
                        updateTagSelects(); 
                    }
                } else if (Array.isArray(data)) {
                    memoList = data;
                } else if (data.memos) {
                     memoList = data.memos;
                }
                const tx = db.transaction(STORE_NAME, 'readwrite'); 
                memoList.forEach(i => tx.objectStore(STORE_NAME).put(i)); 
                tx.oncomplete = () => { 
                    alert('ë³µì› ì™„ë£Œ! (ë©”ëª¨ ë° íƒœê·¸)'); 
                    location.reload(); 
                }; 
            } catch(err) { 
                console.error(err);
                alert('íŒŒì¼ ì˜¤ë¥˜: ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.'); 
            } 
        }; 
        reader.readAsText(file); 
    }
</script>
</body>
</html>
